---
- name: "Bootstrap Kafka server(s)"
  hosts: "kafka-servers"
  become: True

  roles:
    - { role: "nickjj.docker", tags: "docker" }

- name: "Deploy Kafka container"
  hosts: "kafka-servers"
  become: True

  tasks:
    - name: Install pip
      apt:
        name: "python-pip"
        state: "present"
        update_cache: True
        install_recommends: False

    - name: Install Docker-py
      pip:
        name: "{{ item }}"
      with_items:
      - setuptools
      - six
      - docker-py
       
    - name: Copy docker settings to remote
      copy:
        src: docker-compose.yml
        dest: /tmp/docker-compose.yml
        owner: root
        group: root
        mode: 0400
        
    - name: Grab IP to advertise
      shell: export KAFKA_ADVERTISED_HOST_NAME=`ip route show | egrep -v "linkdown|default" | grep -oE '[^ ]+[ ]+$'`
